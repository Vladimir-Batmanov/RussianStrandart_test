# Выполнение тестового задания кандидата

## Обзор

Этот проект содержит SQL и задания на обработку данных, предназначенные для оценки кандидатов. Задания включают написание SQL-запросов, манипуляцию данными и предсказательное моделирование с использованием предоставленных наборов данных. Ниже приведены подробные описания и требования для каждого задания.

## Задания

### Задача 1: SQL-запрос для TOP 2 сотрудников по отделу

**Цель**: Извлечь двух сотрудников из каждого отдела с наивысшими зарплатами, учитывая, что сотрудники могут получать одинаковую сумму.

**Таблицы**:
- `depart`: Отделы
  - `depart_id`: ID Отдела
  - `depart_name`: Название Отдела
- `empl`: Сотрудники
  - `empl_id`: ID Сотрудника
  - `depart_id`: ID Отдела
  - `salary`: Зарплата Сотрудника

**Инструкция**: Написать SQL-запрос для выполнения задачи.

**Файл с решением**: [task_1.sql](./task_1.sql)

### Задача 2: SQL-запрос для анализа транзакций клиентов

**Цель**: Написать SQL-запросы для анализа транзакций клиентов на основе предоставленной структуры данных.

**Таблицы**:
- `em_ag_tab_1_cards`: Все карты клиента
  - `pass_ser`: Серия паспорта
  - `pass_num`: Номер паспорта
  - `is_type`: Тип пластика (1 - дебет, 2 - кредит)
  - `cr_num`: Номер карты
- `em_ag_tab_2_out_trunz`: Исходящие транзакции клиента
  - `cr_num`: Номер карты
  - `date_tranz`: Дата транзакции
  - `buy_category`: Категория покупки
  - `amount`: Сумма покупки
- `em_ag_tab_3_dict_category`: Словарь категорий покупок
  - `buy_category`: Категория покупки
  - `name_category`: Наименование категории

**Инструкция**: Написать SQL-запрос, который выполнит следующее для каждого клиента с более чем одной кредитной картой за сентябрь 2019 года:
1. Сумма всех покупок по всем картам в категории "Алкоголь".
2. Общая сумма всех покупок.
3. Общая сумма всех покупок по кредитным картам.
4. Максимальная сумма покупки в категории "Путешествия".

Отсортировать результаты по убыванию сумм покупок на алкоголь и возрастанию максимальной траты на путешествия.

**Файл с решением**: [task_2.sql](./task_2.sql)

### Задача 3: Предсказательное моделирование

**Цель**: Прогнозировать бинарный целевой признак (`Target`) с использованием предоставленного набора данных о клиентах.

**Набор данных**: `appl_score_sample.csv`, содержащий следующие колонки:
- `CLIENT_ID`: ID Клиента
- `SEX`: Пол (0 - женский, 1 - мужской)
- `CHILD_FLAG`: Наличие детей (1/0 - есть/нет)
- `REALTY_FLAG`: Наличие недвижимости (1/0 - есть/нет)
- `ACCOUNTS_FLAG`: Наличие счета в банке (1/0 - есть/нет)
- `E_MAIL_FLAG`: Наличие электронной почты (1/0 - есть/нет)
- `DCI`: Доход в рублях
- `PROFIT_FAMILY`: Доход семьи в рублях
- `UCI`: Доход по неосновному месту работы в рублях
- `FOREIGN_PASSPORT_FLAG`: Наличие загранпаспорта (1/0 - есть/нет)
- `STANDING_IN_MONTHS_LAST`: Стаж работы на последнем месте работы в месяцах
- `EDUCATION`: Уровень образования
- `TRANSPORT_AMOUNT`: Количество транспортных средств в собственности
- `Target`: Целевой бинарный признак

**Инструкция**:
1. Выбрать метод моделирования и обосновать выбор по различным критериям.
2. Оценить модель на стабильность и наличие переобучения.

1. **Выбор метода моделирования и итоговой модели обоснование:**

   В процессе моделирования, выбор модели обосновывается следующими шагами:
   - **Анализ данных**: На основании анализа данных, включая проверку распределений, корреляций и возможных выбросов, было выбрано несколько потенциальных моделей для тестирования.
   - **Гиперпараметры и валидация**: Были применены методы кросс-валидации и сеточного поиска (Grid Search) для настройки гиперпараметров. Это позволило найти оптимальные параметры для моделей, что повышает их точность и обобщающую способность.
   - **Сравнение моделей**: Различные модели (например, логистическая регрессия, случайный лес, градиентный бустинг) были протестированы на валидационных данных. Наилучшие результаты были получены от модели, выбранной в качестве "best_model".
   - **Оценка метрик**: Основные метрики (точность, полнота, ROC AUC) использовались для оценки производительности моделей. Итоговая модель была выбрана на основе наилучших значений этих метрик.

   В результате наилучшей моделью оказался **CatBoost**, с результатами кросс-валидации:
   - **Accuracy (Train)**: 0.709
   - **ROC AUC Score (Train)**: 0.775
   - **Accuracy (Test)**: 0.624
   - **ROC AUC Score (Test)**: 0.670

2. **Является ли прогноз стабильным? Не переобучили ли Вы модель? (обоснование):**

   Стабильность прогноза и отсутствие переобучения были проверены с помощью следующих методов:
   - **Кросс-валидация**: Применение метода кросс-валидации на разных подвыборках данных показало стабильный результат в среднем - 0.72, что указывает на хорошую обобщающую способность модели.
   - **Кривые обучения**: Построение кривых обучения продемонстрировало, что модель обучается адекватно. Если бы модель была переобучена, то мы бы наблюдали высокую точность на обучающей выборке и низкую на тестовой. Однако, из представленных графиков видно, что разрыв между этими метриками небольшой, что свидетельствует о правильной настройке модели.
   - **Стандартное отклонение**: Низкое стандартное отклонение как для обучающей, так и для тестовой выборок указывает на то, что модель работает стабильно и результаты не сильно варьируются между разными подвыборками данных.

**Файл с решением**: [task_3.ipynb](./task_3.ipynb)

### Задача 4: Манипуляции с данными в DataFrame

**Цель**: Выполнить манипуляции с данными, используя набор данных `appl_score_sample.csv`.

**Инструкция**:
1. Создать DataFrame `subset_1`, содержащий только первые 20 строк и только 1 и 5 колонку.
2. Создать DataFrame `subset_2`, содержащий только клиентов-мужчин (`SEX = 1`), у которых значения переменной `STANDING_IN_MONTHS_LAST` строго больше 50.
3. Создать две новые переменные:
   - `CI = DCI + UCI`
   - `CI_ln = ln(CI)`
4. Рассчитать среднее значение переменной `CI` для каждого уровня образования (`EDUCATION`), не превращая `EDUCATION` в индекс, и переименовать колонку со средним значением `CI` в `MEAN_CI`.
5. Заменить все отрицательные значения в переменной `TRANSPORT_AMOUNT` на медианное значение этой переменной (исключая отрицательные значения).

**Файлы с решением**:
- [task_4.1.sql](.task_4.1.sql)
- [task_4.2.sql](./task_4.2.sql)
- [task_4.4.sql](./task_4.4.sql)
- [task_4.5.sql](./task_4.5.sql)

## Требования

- Выполнить задания с использованием SQL для работы с базами данных и Python для манипуляций с данными и моделирования.
- Обосновать выбор методов и подходов для задач моделирования.
- Обеспечить целостность данных и корректное выполнение всех условий задач.

